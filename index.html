<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" href="favicon.ico" type="image/x-icon">
 <link rel="stylesheet" href="style.css">
 <title>MB World Edit</title>
 <style>
    /* --- ESTILOS INVENTARIO MEJORADO (MODIFICADO) --- */
    #inventory-modal .modal-content {
        background: #C6C6C6; 
        border: 2px solid #555;
        width: 700px;
        padding: 0;   
        color: #000;
        display: flex; 
        flex-direction: column;
        height: 550px; /* Aumentada altura para acomodar tabs */
    }
    
    /* Contenedor principal: Ahora en columna */
    .inventory-layout {
        display: flex;
        flex-direction: column; /* Cambiado a columna para apilar elementos */
        flex: 1;
        overflow: hidden;
        padding: 10px;
    }

    /* Barra de pesta√±as (Horizontal) */
    #inventory-tabs-sidebar {
        width: 100%;
        display: flex;
        flex-direction: row; /* Alineaci√≥n horizontal */
        gap: 5px;
        margin-right: 0;
        margin-top: 5px;
        padding-left: 5px;
        z-index: 10;
    }

    .inv-tab-btn {
        width: 40px;
        height: 40px;
        background: #8B8B8B;
        border: 2px solid #373737;
        border-bottom-color: #FFF; /* Borde inferior claro por defecto */
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .inv-tab-btn.active {
        background: #C6C6C6; 
        border-color: #FFF;
        border-bottom: none; /* Sin borde inferior para conectar con el √°rea principal */
        height: 45px; /* Crece para tapar el borde del grid */
        position: relative;
        margin-bottom: -2px; /* Superpone el borde del grid */
        border-right: 2px solid #373737;
    }

    /* √Årea principal */
.inventory-main-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #C6C6C6;
        min-height: 0; /* IMPORTANTE: Permite que el contenedor se encoja y no se desborde */
    }

    .inv-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
        padding-right: 10px;
    }

    #inventory-search {
        width: 100%;
        padding: 8px;
        background: #333;
        color: white;
        border: 2px solid #A0A0A0;
        font-family: monospace;
        margin-bottom: 0; /* Quitamos margen inferior para pegar las tabs */
    }

#inventory-grid {
        display: grid;
        grid-template-columns: repeat(9, 1fr);
        gap: 2px;
        overflow-y: auto; /* Esto habilita el scroll */
        background: #8B8B8B;
        padding: 5px;
        border: 2px solid #373737;
        border-top: 2px solid #373737;
        border-bottom-color: #FFF;
        border-right-color: #FFF;
        flex: 1; 
        min-height: 0; /* IMPORTANTE: Fuerza al grid a respetar el espacio disponible */
    }

    .inv-item {
        width: 100%;
        aspect-ratio: 1;
        background: #8B8B8B;
        border: 1px solid transparent;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }
    .inv-item:hover {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid #FFF;
    }
    
    /* Hotbar en Ribbon */
    #hotbar-container {
        display: flex;
        gap: 2px;
        background: #C6C6C6;
        padding: 4px;
        border: 2px solid #555;
        margin: 0 auto; 
    }
    .hotbar-slot {
        width: 32px;
        height: 32px;
        border: 2px solid #8B8B8B;
        background: #8B8B8B;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }
    .hotbar-slot.active {
        border-color: #FFF;
        background: #A0A0A0;
        box-shadow: inset 0 0 4px rgba(0,0,0,0.5);
    }
 </style>
</head>
<body>
 
 <div id="top-bar">
  <div class="left-group">
   <button class="icon-btn" onclick="document.getElementById('file-input').click()">üìÇ Load World</button>
   <button class="icon-btn" onclick="fileManager.export()">üíæ Save World</button>
   <button class="icon-btn" onclick="openModal('settings-modal')">‚öôÔ∏è Configuration</button>
   <div class="separator"></div>
   <button class="icon-btn" onclick="historyManager.undo()" title="Undo (Ctrl+Z)">‚Ü∂</button>
   <button class="icon-btn" onclick="historyManager.redo()" title="Redo (Ctrl+Y)">‚Ü∑</button>
   <div class="separator"></div>
   <div class="filename-wrapper">
    <input type="text" id="filename-display" value="world" oninput="updateFilename(this.value)">
    <span class="extension">.mbw</span>
   </div>
  </div>
 </div>

 <div id="ribbon">
  <div class="tabs">
   <button class="tab-btn active" onclick="openTab('insert')">Insert</button>
   <button class="tab-btn" onclick="openTab('settings')">World Settings</button>
   <button class="tab-btn" onclick="openTab('view')">View</button>
  </div>
  <div class="tab-content">
   
   <div id="tab-insert" class="tab-pane active" style="display: flex; justify-content: center; width: 100%;">
        <div id="hotbar-container"></div>
        <div style="margin-left: 20px; align-self: center; font-size: 12px; color: #888;">Press 'E' for Inventory</div>
   </div>

   <div id="tab-settings" class="tab-pane">
    <div class="input-group">
     <label style="margin-right: 5px;">Gamemode:</label>
     <select id="gamemode">
      <option value="0">Survival</option>
      <option value="1">Creative</option>
      <option value="2">Adventure</option>
      <option value="3">Spectator</option>
     </select>
    </div>
    <label style="cursor: pointer;"><input type="checkbox" id="cheats"> Cheats</label>
    <div class="separator"></div>
    <button onclick="openModal('achievements-modal')">üèÜ Manage Achievements</button>
   </div>
   <div id="tab-view" class="tab-pane">
    <label><input type="checkbox" id="show-grid" onchange="toggleGrid(this.checked)"> Show Grid</label>
    <div class="separator"></div>
    <div class="input-group">
        <label style="margin-right: 5px;">Dimension:</label>
        <select id="dimension">
         <option value="1">Overworld</option>
         <option value="2">Nether</option>
         <option value="3">End</option>
        </select>
    </div>
   </div>
  </div>
 </div>

 <div id="toolbar-sidebar">
    <button class="tool-btn active" id="tool-pencil" onclick="selectTool('pencil')" title="Pencil">‚úèÔ∏è</button>
    <button class="tool-btn" id="tool-eraser" onclick="selectTool('eraser')" title="Eraser">üßº</button>
    <button class="tool-btn" id="tool-bucket" onclick="selectTool('bucket')" title="Bucket">ü™£</button>
	<button class="tool-btn" id="tool-select" onclick="selectTool('select')" title="Select">üî≥</button>
    <button class="tool-btn" id="tool-lasso" onclick="selectTool('lasso')" title="Free form">‚û∞</button>
    <button class="tool-btn" id="tool-eyedropper" onclick="selectTool('eyedropper')" title="Gotero">üíß</button>
    <div class="separator" style="width: 80%; height: 1px; background: #444; margin: 5px 0;"></div>
    <button class="tool-btn" onclick="takeScreenshot()" title="Screenshot">üì∑</button>
    <button class="tool-btn" onclick="toggleConsole()" title="Teletransportation">üìç</button>
 </div>

 <div id="workspace">
  <div id="coords-overlay">X: 0 Y: 0</div>
  <div id="zoom-floating">
    <label for="zoom-slider">Zoom</label>
    <input type="range" id="zoom-slider" min="0" max="4" step="1" value="2" oninput="updateZoomSlider(this.value)">
    <span id="zoom-value">100%</span>
  </div>
  <div id="console-overlay" style="display: none;">
      <div class="console-container">
          <div id="console-suggestion">/tp [x] [y]</div>
          <input type="text" id="console-input" placeholder="Escribe comando...">
      </div>
  </div>
  <canvas id="canvas"></canvas>
 </div>

 <div id="settings-modal" class="modal">
    <div class="modal-content" style="width: 400px;">
        <span class="close-modal" onclick="closeModal('settings-modal')">&times;</span>
        <h2>Settings</h2>
        <div class="settings-row">
            <label>Theme</label>
            <select id="theme-select" onchange="setTheme(this.value)">
                <option value="dark">‚ö´ Dark (Default)</option>
                <option value="white">‚ö™ White</option>
                <option value="pastel">üå∏ Pastel</option>
                <option value="darkblue">üîµ Dark Blue</option>
            </select>
        </div>
    </div>
 </div>

 <div id="inventory-modal" class="modal">
    <div class="modal-content">
        <div class="inventory-layout">
            
            <div class="inventory-main-area">
                <div class="inv-header">
                    <h3>Inventory</h3>
                    <span class="close-modal" onclick="closeModal('inventory-modal')" style="cursor:pointer; font-weight:bold;">&times;</span>
                </div>
                
                <input type="text" id="inventory-search" placeholder="Search..." oninput="filterInventory(this.value)">
                
                <div id="inventory-tabs-sidebar">
                </div>

                <div id="inventory-grid">
                </div>
            </div>
        </div>
    </div>
 </div>

 <div id="achievements-modal" class="modal">
  <div class="modal-content">
   <span class="close-modal" onclick="closeModal('achievements-modal')">&times;</span>
   <h2>Achievements Manager</h2>
   <div class="modal-actions">
    <button onclick="toggleAchievements(true)">Unlock All</button>
    <button onclick="toggleAchievements(false)">Reset All</button>
   </div>
<div id="achievements-list">
    <label><input type="checkbox" data-index="44"> Breed two animals</label>
    <label><input type="checkbox" data-index="43"> Brew a potion</label>
    <label><input type="checkbox" data-index="3"> Craft a crafting table</label>
    <label><input type="checkbox" data-index="5"> Craft a stone pickaxe</label>
    <label><input type="checkbox" data-index="4"> Craft a wooden pickaxe</label>
    <label><input type="checkbox" data-index="6"> Craft an iron pickaxe</label>
    <label><input type="checkbox" data-index="22"> Defeat a flaming chicken</label>
    <label><input type="checkbox" data-index="25"> Eat some food</label>
    <label><input type="checkbox" data-index="45"> Enchant an item</label>
    <label><input type="checkbox" data-index="33"> Fire a bow</label>
    <label><input type="checkbox" data-index="39"> Fish a fish</label>
    <label><input type="checkbox" data-index="23"> Grow a farm</label>
    <label><input type="checkbox" data-index="10"> Grow a tree</label>
    <label><input type="checkbox" data-index="24"> Make a cake</label>
    <label><input type="checkbox" data-index="7"> Make a furnace</label>
    <label><input type="checkbox" data-index="8"> Make an iron ingot</label>
    <label><input type="checkbox" data-index="30"> Make portal stone</label>
    <label><input type="checkbox" data-index="9"> Make some torches</label>
    <label><input type="checkbox" data-index="0"> Mine a block of wood</label>
    <label><input type="checkbox" data-index="29"> Mine diamonds</label>
    <label><input type="checkbox" data-index="28"> Mine gold</label>
    <label><input type="checkbox" data-index="27"> Mine obsidian</label>
    <label><input type="checkbox" data-index="32"> Open a door with wiring</label>
    <label><input type="checkbox" data-index="2"> Open the inventory</label>
    <label><input type="checkbox" data-index="1"> Place a block</label>
    <label><input type="checkbox" data-index="19"> Slay a blaze</label>
    <label><input type="checkbox" data-index="13"> Slay a cow</label>
    <label><input type="checkbox" data-index="21"> Slay a creeper</label>
    <label><input type="checkbox" data-index="42"> Slay a ghast by its fireball</label>
    <label><input type="checkbox" data-index="38"> Slay a magma cube</label>
    <label><input type="checkbox" data-index="18"> Slay a nethereye</label>
    <label><input type="checkbox" data-index="12"> Slay a pig</label>
    <label><input type="checkbox" data-index="14"> Slay a sheep</label>
    <label><input type="checkbox" data-index="16"> Slay a skeleton</label>
    <label><input type="checkbox" data-index="37"> Slay a slime</label>
    <label><input type="checkbox" data-index="17"> Slay a spider</label>
    <label><input type="checkbox" data-index="15"> Slay a zombie</label>
    <label><input type="checkbox" data-index="41"> Slay a zombie pigman</label>
    <label><input type="checkbox" data-index="20"> Slay an enderman</label>
    <label><input type="checkbox" data-index="36"> Slay the ender dragon</label>
    <label><input type="checkbox" data-index="11"> Tame a dog</label>
    <label><input type="checkbox" data-index="34"> Teleport with enderpearl</label>
    <label><input type="checkbox" data-index="31"> Travel to the nether</label>
    <label><input type="checkbox" data-index="35"> Unlock the ender portal</label>
    <label><input type="checkbox" data-index="26"> Use a bed</label>
    <label><input type="checkbox" data-index="40"> Use an anvil</label>
</div>
  </div>
 </div>

 <input type="file" id="file-input" accept=".mbw" style="display: none;">

 <script src="scripts/ui-handler.js"></script>
 <script src="scripts/mbwom.js"></script>
 <script src="scripts/mbw-algorithm.js"></script>
 <script src="scripts/history.js"></script>
 <script src="scripts/input.js"></script>
 <script src="scripts/file-manager.js"></script>
 <script src="scripts/textures.js"></script>
 <script src="scripts/rendering.js"></script>
 <script src="scripts/clipboard.js"></script>
 <script src="main.js"></script>
 <script src="scripts/tools.js"></script>
</body>
</html>